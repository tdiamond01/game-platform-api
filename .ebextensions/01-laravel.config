option_settings:
  aws:elasticbeanstalk:application:environment:
    COMPOSER_HOME: /root

  aws:elasticbeanstalk:container:php:phpini:
    document_root: /public
    memory_limit: 256M
    max_execution_time: 60

packages:
  yum:
    git: []

container_commands:
  01_install_composer:
    command: "export COMPOSER_HOME=/root && composer install --no-dev --optimize-autoloader --no-interaction"
    leader_only: false

  02_storage_permissions:
    command: "chmod -R 775 storage bootstrap/cache"
    leader_only: false

  03_create_storage_link:
    command: "php artisan storage:link --force"
    leader_only: true

  04_clear_cache:
    command: "php artisan config:clear && php artisan cache:clear && php artisan route:clear && php artisan view:clear"
    leader_only: true

  05_cache_config:
    command: "php artisan config:cache && php artisan route:cache && php artisan view:cache"
    leader_only: true

  06_run_migrations:
    command: "php artisan migrate --force"
    leader_only: true

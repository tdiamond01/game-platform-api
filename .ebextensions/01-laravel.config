option_settings:
  aws:elasticbeanstalk:application:environment:
    COMPOSER_HOME: /root

  aws:elasticbeanstalk:container:php:phpini:
    document_root: /public
    memory_limit: 256M
    max_execution_time: 60

packages:
  yum:
    git: []

container_commands:
  01_storage_permissions:
    command: "chmod -R 775 storage bootstrap/cache"
    cwd: "/var/app/staging"

  02_create_storage_link:
    command: "php artisan storage:link --force || true"
    cwd: "/var/app/staging"
    leader_only: true

  03_clear_cache:
    command: "php artisan config:clear && php artisan cache:clear && php artisan route:clear && php artisan view:clear"
    cwd: "/var/app/staging"
    leader_only: true

  04_cache_config:
    command: "php artisan config:cache && php artisan route:cache && php artisan view:cache"
    cwd: "/var/app/staging"
    leader_only: true

  05_run_migrations:
    command: "php artisan migrate --force"
    cwd: "/var/app/staging"
    leader_only: true
